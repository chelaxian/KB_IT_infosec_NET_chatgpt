–í–æ—Ç **–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**, –∫–∞–∫ **–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å 5 VPS –≤ –µ–¥–∏–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ 250 –ì–ë**, **–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑–∞–≤ –∏—Ö –≤ –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω—É—é —Å–µ—Ç—å —á–µ—Ä–µ–∑ WireGuard**, –∏ –∑–∞—Ç–µ–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å **–∫–ª–∞—Å—Ç–µ—Ä GlusterFS**, —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º –æ–±—â–µ–π –ø–∞–ø–∫–∏ –≤ LXC-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Proxmox VE.

---

# üß© –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: WireGuard + GlusterFS –Ω–∞ 5 VPS

## üß± –ß–ê–°–¢–¨ 1: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∑–ª–æ–≤ –≤ –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω—É—é WireGuard-—Å–µ—Ç—å

### –®–∞–≥ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard –Ω–∞ –≤—Å–µ—Ö 5 VPS

–ù–∞ **–∫–∞–∂–¥–æ–º** –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤:

```bash
sudo apt update
sudo apt install -y wireguard
```

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏:

```bash
wg genkey | tee /etc/wireguard/privatekey | wg pubkey > /etc/wireguard/publickey
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–≤–æ–¥:

```bash
cat /etc/wireguard/privatekey
cat /etc/wireguard/publickey
```

### –®–∞–≥ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ `10.8.0.0/24`

* –ü—É—Å—Ç—å IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è WG –±—É–¥—É—Ç:

  * `server1` ‚Üí `10.8.0.1`
  * `server2` ‚Üí `10.8.0.2`
  * `server3` ‚Üí `10.8.0.3`
  * `server4` ‚Üí `10.8.0.4`
  * `server5` ‚Üí `10.8.0.5`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/wireguard/wg0.conf` **–Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ**:

```ini
[Interface]
PrivateKey = <PRIVATE_KEY_–¢–ï–ö–£–©–ï–ì–û_–°–ï–†–í–ï–†–ê>
Address = 10.8.0.X/24
ListenPort = 51820

# –ü—Ä–∏–º–µ—Ä: –¥–ª—è server1 –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞–∫ peer'–æ–≤

[Peer]
PublicKey = <PUBKEY_server2>
AllowedIPs = 10.8.0.2/32
Endpoint = <EXTERNAL_IP_server2>:51820
PersistentKeepalive = 25

[Peer]
PublicKey = <PUBKEY_server3>
AllowedIPs = 10.8.0.3/32
Endpoint = <EXTERNAL_IP_server3>:51820
PersistentKeepalive = 25

[Peer]
PublicKey = <PUBKEY_server4>
AllowedIPs = 10.8.0.4/32
Endpoint = <EXTERNAL_IP_server4>:51820
PersistentKeepalive = 25

[Peer]
PublicKey = <PUBKEY_server5>
AllowedIPs = 10.8.0.5/32
Endpoint = <EXTERNAL_IP_server5>:51820
PersistentKeepalive = 25
```

–ù–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –∏–∑–º–µ–Ω—è—è `[Interface]` –∏ `[Peer]`-–±–ª–æ–∫–∏.

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ufw` –∏–ª–∏ `iptables` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç UDP 51820:

```bash
ufw allow 51820/udp
```

–ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è:

```bash
chmod 600 /etc/wireguard/wg0.conf
wg-quick up wg0
systemctl enable wg-quick@wg0
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∏–Ω–≥–æ–º –∏ `wg show`, —á—Ç–æ –≤—Å–µ –ø–∏—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã.

---

## üì¶ –ß–ê–°–¢–¨ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ GlusterFS –ø–æ–≤–µ—Ä—Ö WireGuard

### –®–∞–≥ 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GlusterFS

–ù–∞ **–≤—Å–µ—Ö 5 VPS** (Debian 11):

```bash
sudo apt update && sudo apt install -y glusterfs-server
sudo systemctl enable --now glusterd
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
sudo systemctl status glusterd
```

### –®–∞–≥ 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `/etc/hosts` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IP

–ï—Å–ª–∏ –Ω–µ—Ç DNS, –ø—Ä–æ–ø–∏—à–∏—Ç–µ –≤ `/etc/hosts` –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö:

```text
10.8.0.1 server1
10.8.0.2 server2
10.8.0.3 server3
10.8.0.4 server4
10.8.0.5 server5
```

### –®–∞–≥ 5. –°–æ–∑–¥–∞–Ω–∏–µ brick-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–ù–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ:

```bash
sudo mkdir -p /gluster-storage
```

### –®–∞–≥ 6. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∑–ª–æ–≤ –≤ trusted pool

–ù–∞ **–æ–¥–Ω–æ–º –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, server1):

```bash
gluster peer probe server2
gluster peer probe server3
gluster peer probe server4
gluster peer probe server5
```

–ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å:

```bash
gluster peer status
```

### –®–∞–≥ 7. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ç–æ–º–∞

```bash
sudo gluster volume create vps_shared \
  server1:/gluster-storage \
  server2:/gluster-storage \
  server3:/gluster-storage \
  server4:/gluster-storage \
  server5:/gluster-storage \
  force
```

–ó–∞–ø—É—Å–∫ —Ç–æ–º–∞:

```bash
sudo gluster volume start vps_shared
gluster volume info vps_shared
```

---

## üìÇ –ß–ê–°–¢–¨ 3: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ —Ç–æ–º–∞

### –®–∞–≥ 8. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞ **–∫–∞–∂–¥–æ–º VPS**:

```bash
sudo mkdir -p /mnt/vps_shared
sudo mount -t glusterfs localhost:/vps_shared /mnt/vps_shared
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `/etc/fstab`:

```text
localhost:/vps_shared /mnt/vps_shared glusterfs defaults,_netdev 0 0
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
df -h
df -h | grep vps_shared
ls /mnt/vps_shared
```

---

## üì¶ –ß–ê–°–¢–¨ 4: –ü—Ä–æ–±—Ä–æ—Å –ø–∞–ø–∫–∏ –≤ LXC-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Proxmox

### –®–∞–≥ 9. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ bind-mount –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ù–∞ **Proxmox-—Ö–æ—Å—Ç–µ** (–≤ –∫–∞–∂–¥–æ–º VPS):

```bash
pct set <CTID> -mp0 /mnt/vps_shared,mp=/mnt/vps_shared
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ `/etc/pve/lxc/<CTID>.conf`:

```text
mp0: /mnt/vps_shared,mp=/mnt/vps_shared
```

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!**

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
pct start <CTID>
```

–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
ls /mnt/vps_shared
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ:

   ```bash
   echo "test" > /mnt/vps_shared/hello.txt
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –≤–∏–¥–µ–Ω –Ω–∞ –¥—Ä—É–≥–∏—Ö VPS –∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö:

   ```bash
   cat /mnt/vps_shared/hello.txt
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (`df -h`, `gluster volume status`, `gluster volume info`).

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* GlusterFS –Ω–µ –¥–µ–ª–∏—Ç –æ–¥–∏–Ω —Ñ–∞–π–ª –Ω–∞ —á–∞—Å—Ç–∏ ‚Äî –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª —Ö—Ä–∞–Ω–∏—Ç—Å—è **—Ü–µ–ª–∏–∫–æ–º** –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ.
* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî \~50‚ÄØ–ì–ë.
* GlusterFS –Ω–µ –ª—é–±–∏—Ç –æ–±—Ä—ã–≤—ã —Å–≤—è–∑–∏: WireGuard –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å.
* –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å GlusterFS Heal –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Replicated Volumes.

---
–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å `ansible-playbook` –∏–ª–∏ bash-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —à–∞–≥–æ–≤.
---

## ‚ÄºÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ **–≤–∞–Ω–∏–ª—å–Ω–æ–≥–æ GlusterFS**: –ø—Ä–∏ **–¥–∏—Å–ø–µ—Ä—Å–Ω–æ–º (distribute-only) —Ç–∏–ø–µ —Ç–æ–º–∞**:

* –≤—ã–±–æ—Ä backend-—Å–µ—Ä–≤–µ—Ä–∞ (brick'–∞) –∏–¥—ë—Ç **–ø–æ —Ö–µ—à—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**,
* **–Ω–∏–∫–∞–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç**,
* –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π brick **–Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ñ–∞–π–ª** (–º–µ—Å—Ç–æ –∫–æ–Ω—á–∏–ª–æ—Å—å), Gluster –ø—Ä–æ—Å—Ç–æ **–ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π `ENOSPC` (–Ω–µ—Ç –º–µ—Å—Ç–∞)**,
* –Ω–∏–∫–∞–∫–æ–≥–æ "–ø–µ—Ä–µ–±–æ—Ä–∞ –¥—Ä—É–≥–∏—Ö brick‚Äô–æ–≤" **–Ω–µ –±—É–¥–µ—Ç** ‚Äî Gluster –Ω–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∞–π–ª **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.

---

## üî• –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏

> –£ —Ç–µ–±—è: 8 —Å–µ—Ä–≤–µ—Ä–æ–≤ = 8 bricks, 360‚ÄØ–ì–ë —Å—É–º–º–∞—Ä–Ω–æ,
> –Ω–æ –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω.

üì¶ –¢—ã –ø–∏—à–µ—à—å —Ñ–∞–π–ª `video.mp4` (1.5 –ì–ë) ‚Äî
–µ–≥–æ –∏–º—è –ø–æ —Ö–µ—à—É –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ **–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π brick**, –∏‚Ä¶

‚û°Ô∏è Gluster –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–æ—à–∏–±–∫—É –∑–∞–ø–∏—Å–∏**, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ **–Ω–∞ –¥—Ä—É–≥–∏—Ö bricks –º–µ—Å—Ç–∞ –ø–æ–ª–Ω–æ**.

---

## üîÅ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç?

–ö—Ä–∞—Ç–∫–æ:
**–ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ "–∑–∞—Å—Ç–∞–≤–∏—Ç—å Gluster" –ø–µ—Ä–µ–∫–∏–Ω—É—Ç—å —Ñ–∞–π–ª –Ω–∞ –¥—Ä—É–≥–æ–π brick –≤ distribute-only.**

–¢—ã –º–æ–∂–µ—à—å —Ç–æ–ª—å–∫–æ:

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞ –≤—Ä—É—á–Ω—É—é

–ü–æ—Å–∫–æ–ª—å–∫—É –≤—ã–±–æ—Ä brick –∑–∞–≤–∏—Å–∏—Ç –æ—Ç **—Ö–µ—à–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞**, —Ç—ã –º–æ–∂–µ—à—å:

1. –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞: –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç—Ñ–∏–∫—Å:
   `video.mp4` ‚Üí `video__1.mp4`
2. Gluster –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Ö–µ—à, –∏ —Ç–µ–ø–µ—Ä—å –æ–Ω **–º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π brick**.
3. –ü–æ–≤—Ç–æ—Ä—è—Ç—å —ç—Ç–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–π brick.

```bash
cp video.mp4 /mnt/glusterfs/video__1.mp4
# –ï—Å–ª–∏ –æ–ø—è—Ç—å ENOSPC, –ø—Ä–æ–±—É–π video__2.mp4 –∏ —Ç.–¥.
```

‚úîÔ∏è –†–∞–±–æ—Ç–∞–µ—Ç.
‚ùå –ù–æ –≤—Ä—É—á–Ω—É—é ‚Äî –Ω–µ—É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –≤—Ä—É—á–Ω—É—é –ø–æ—á–∏—Å—Ç–∏—Ç—å –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ brick'–µ

–ï—Å–ª–∏ —Ç—ã **–º–æ–∂–µ—à—å –æ—á–∏—Å—Ç–∏—Ç—å** –º–µ—Å—Ç–æ –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (—É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã, –¥–æ–±–∞–≤–∏—Ç—å –¥–∏—Å–∫, —É–≤–µ–ª–∏—á–∏—Ç—å partition) ‚Äî —ç—Ç–æ **—Å–∞–º—ã–π –ø—Ä—è–º–æ–π —Å–ø–æ—Å–æ–±**.

```bash
ssh brick7 'rm -rf /bricks/data/some_old_files'
# –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥–∏—Å–∫ –∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å
```

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 3: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π brick –∏ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–±–∞–ª–∞–Ω—Å

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –µ—â—ë —Ö–æ—Å—Ç—ã –∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∏—Å–∫–∏:

1. –î–æ–±–∞–≤—å –Ω–æ–≤—ã–π brick:

```bash
gluster volume add-brick myvol serverX:/brick/path
```

2. –ó–∞–ø—É—Å—Ç–∏ **—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö**:

```bash
gluster volume rebalance myvol start
```

–≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç Gluster –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –ø–æ –Ω–æ–≤—ã–º rules (–≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–π brick).

‚ùó **–ù–æ —ç—Ç–æ –ù–ï —Ä–µ—à–∏—Ç –æ—à–∏–±–∫—É —Ç–µ–∫—É—â–µ–π –∑–∞–ø–∏—Å–∏**. –ü—Ä–æ—Å—Ç–æ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —Ä–∞–∑–≥—Ä—É–∑–∏—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ bricks.

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 4: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **replica** –∏–ª–∏ **disperse** –≤–º–µ—Å—Ç–æ distribute-only

–ï—Å–ª–∏ —É —Ç–µ–±—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω **replica volume** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2x —Ä–µ–ø–ª–∏–∫–∞), —Ç–æ –∑–∞–ø–∏—Å—å –∏–¥—ë—Ç **–Ω–∞ 2 brick‚Äô–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**.
–¢–æ–≥–¥–∞, –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –ø–æ–ª–æ–Ω, –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç **–≤—Å—ë –µ—â—ë –ø—Ä–æ–π—Ç–∏**, –µ—Å–ª–∏ —É –≤—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –º–µ—Å—Ç–æ.

–ù–æ:

* —Ä–∞—Å—Ö–æ–¥ –º–µ—Å—Ç–∞ –≤—ã—à–µ (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è),
* –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –∫–æ–ø–∏–π ‚Äî —É–ø–∞–¥—ë—Ç.

---

## ‚ùå –ß—Ç–æ –ù–ï –ø–æ–º–æ–∂–µ—Ç

| –ú–µ—Ç–æ–¥                                | –ü–æ—á–µ–º—É –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç                         |
| ------------------------------------ | ------------------------------------------- |
| –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ `glusterd`                | –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä brick                    |
| –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ / –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ    | Brick –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ —Ö–µ—à—É          |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `du` / `df` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ | –ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç –æ —Å–≤–æ–±–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –Ω–∞ bricks |

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é ‚Äî —É —Ç–µ–±—è **–≤—Å–µ–≥–æ –¥–≤–∞ —Ä–∞–±–æ—á–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞**:

1. **–ú–µ–Ω—è—Ç—å –∏–º—è —Ñ–∞–π–ª–∞**, –ø–æ–∫–∞ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–π brick (—Ä—É—á–∫–∞–º–∏ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º).
2. **–û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ** –∏–ª–∏ **–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π brick –∏ –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å** (`gluster volume rebalance`).

---

## üõ† –ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `smart_cp.sh`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:

* —É–∑–Ω–∞–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞,
* –¥–µ–ª–∞—Ç—å —Ö–µ—à–∏ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –∏–º—ë–Ω (`filename__1`, `__2`, –∏ —Ç.–¥.),
* –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π brick –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É,
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ –Ω—ë–º —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ,
* –∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç –º–µ—Å—Ç–∞.

---

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Gluster-–Ω–æ–¥ **–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥**, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –Ω—ë–º —É–∫–∞–∑–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:

```bash
INTERVAL=60
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

* –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö IP –ø–æ –ø–æ—Ä—Ç—É 24007;
* –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Äî –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω `systemctl restart glusterd`, –∑–∞—Ç–µ–º –ø–∞—É–∑–∞ 10 —Å–µ–∫—É–Ω–¥;
* –¥–∞–ª—å—à–µ —Å–Ω–æ–≤–∞ —Ü–∏–∫–ª –æ–∂–∏–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

### üîÑ –•–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥?

–ü—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è–π –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `INTERVAL=60` –≤ `/usr/local/bin/gluster_watchdog.sh` –Ω–∞ –Ω—É–∂–Ω–æ–µ —Ç–µ–±–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
INTERVAL=15  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:

```bash
systemctl restart gluster-watchdog.service
```

–í–æ—Ç **–ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è** –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∞—Å—Ç–µ—Ä–æ–º **GlusterFS**, –≤–∫–ª—é—á–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ. –í—Å—ë –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ –∫–∞–∫ **—à–ø–∞—Ä–≥–∞–ª–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–ª–∞—Å—Ç–µ—Ä–∞**:

---

## üì¶ 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä (peer)

### –ù–∞ **–ª—é–±–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º** —É–∑–ª–µ –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
gluster peer probe <hostname –∏–ª–∏ IP –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞>
```

‚ùó –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–∞ –Ω–æ–≤–æ–º —É–∑–ª–µ:

* –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç `24007/tcp` (GlusterD)
* —Ä–∞–±–æ—Ç–∞–µ—Ç `glusterd`
* —Å–æ–≤–ø–∞–¥–∞—é—Ç –≤–µ—Ä—Å–∏–∏ GlusterFS
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∏–º–µ–Ω–∞/—Ö–æ—Å—Ç—ã (`/etc/hosts` –∏–ª–∏ DNS)

üëâ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
gluster peer status
```

---

## üß± 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–º–∞ (volume)

```bash
gluster volume create <volume-name> replica <N> transport tcp \
<host1>:/gluster_bricks/brick1 \
<host2>:/gluster_bricks/brick1 \
<hostN>:/gluster_bricks/brick1 force
```

> üìå –ü—Ä–∏–º–µ—Ä: replica 3 ‚Äî —Ç—Ä–∏ –∫–æ–ø–∏–∏

–ó–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
gluster volume start <volume-name>
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
gluster volume info
```

---

## üîÅ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ç–æ–º—É

1. **–°–æ–∑–¥–∞–π brick** –Ω–∞ –Ω–æ–≤–æ–º —É–∑–ª–µ:

```bash
mkdir -p /gluster_bricks/brick1
```

2. **–î–æ–±–∞–≤—å brick –≤ volume**:

```bash
gluster volume add-brick <volume-name> <new-host>:/gluster_bricks/brick1
```

‚ùó –î–ª—è **replica** —É–∫–∞–∂–∏:

```bash
gluster volume add-brick <volume-name> replica <new-replica-count> \
<host1>:/brick1 <host2>:/brick1 <new-host>:/brick1
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
gluster volume info
```

---

## üîÑ 4. –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (rebalancing) –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è bricks

```bash
gluster volume rebalance <volume-name> start
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:

```bash
gluster volume rebalance <volume-name> status
```

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:

```bash
gluster volume rebalance <volume-name> stop
```

---

## ‚öôÔ∏è 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö

```bash
gluster volume sync <volume-name> all
```

---

## üßº 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏ –∑–¥–æ—Ä–æ–≤—å—è

```bash
gluster peer status
gluster volume status
gluster volume info
gluster volume heal <volume-name> info
```

---

## ü©π 7. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ / Heal

–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤:

```bash
gluster volume heal <volume-name> info
```

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ:

```bash
gluster volume heal <volume-name> full
```

---

## üß® 8. –£–¥–∞–ª–µ–Ω–∏–µ brick

‚ùó –°–Ω–∞—á–∞–ª–∞ **rebalance**, –ø–æ—Ç–æ–º **remove**:

```bash
gluster volume remove-brick <volume-name> replica <new-count> \
<host-to-remove>:/brick1 start
gluster volume remove-brick <volume-name> ... status
gluster volume remove-brick <volume-name> ... commit
```

---

## üóëÔ∏è 9. –£–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞

1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ **–Ω–∞ —ç—Ç–æ–º —É–∑–ª–µ –±–æ–ª—å—à–µ –Ω–µ—Ç bricks** (`gluster volume info`)
2. –£–¥–∞–ª–∏ peer:

```bash
gluster peer detach <host>
```

–ï—Å–ª–∏ –Ω–æ–¥–∞ –º–µ—Ä—Ç–≤–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç:

```bash
gluster peer detach <host> force
```

---

## üì¶ 10. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–º–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `glusterfs-client`):

```bash
mount -t glusterfs <gluster-host>:/<volume-name> /mnt/gluster
```

---

## üîê 11. –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ FUSE –∏–ª–∏ NFS (–ø–æ –≤—ã–±–æ—Ä—É)

* FUSE: `mount -t glusterfs`
* NFS: `mount -t nfs -o vers=3 <host>:/<volume> /mnt`

---

## üß≠ 12. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–ø–æ–º–∏–º–æ watchdog-–∞)

–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (cron –∏–ª–∏ systemd):

```bash
gluster volume status | grep -q 'Offline' && echo "–ï—Å—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω brick-–∏"
gluster peer status | grep -q 'Disconnected' && echo "–ï—Å—Ç—å –æ—Ç–≤–∞–ª–∏–≤—à–∏–µ—Å—è peer-—ã"
```

---

## üìå –°–æ–≤–µ—Ç—ã

| –ß—Ç–æ                       | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è                                                                        |
| ------------------------- | ----------------------------------------------------------------------------------- |
| **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏** | –£—Å—Ç–∞–Ω–æ–≤–∏ `chrony` –∏–ª–∏ `ntpd` –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö                                          |
| **DNS/–∏–º–µ–Ω–∞**             | –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –∏–ª–∏ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ `/etc/hosts`                                  |
| **–†–∞–∑–¥–µ–ª—ã –¥–ª—è brick'–æ–≤**  | –ù–µ –º–æ–Ω—Ç–∏—Ä—É–π `/brick1` –Ω–∞ `/` ‚Äî –≤—ã–¥–µ–ª—è–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª –∏–ª–∏ LVM                     |
| **Volume Options**        | –í–∫–ª—é—á–∏ –ø–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏—á–∏: `performance.cache-size`, `server.allow-insecure` –∏ –ø—Ä.       |
| **WireGuard / VPN**       | –ò—Å–ø–æ–ª—å–∑—É–π `PersistentKeepalive` + —É–±–µ–¥–∏—Å—å, —á—Ç–æ `glusterd` —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ `wg-quick` |

---




