# Полная инструкция для настройки TFTP и загрузки файла через EFI Shell

---

## Часть 1: Настройка TFTP-сервера

1. **Клонирование репозитория TFTP-сервера:**
   ```bash
   git clone https://github.com/lfkeitel/tftp-go
   ```

2. **Установка Go (если не установлен):**
   ```bash
   apt install golang
   ```

3. **Сборка сервера:**
   ```bash
   cd tftp-go/
   go build
   ```

4. **Загрузка файла для загрузки через TFTP:**
   ```bash
   wget https://boot.netboot.xyz/ipxe/netboot.xyz-arm64.efi
   ```

   *(Дополнительно, можно загрузить другие образы, например, Limine)*  
   ```bash
   # wget https://github.com/limine-bootloader/limine/blob/v8.6.1-binary/BOOTAA64.EFI
   ```

5. **Переименование файла для удобства:**
   ```bash
   cp netboot.xyz-arm64.efi arm.efi
   ```

6. **Настройка прав доступа для файла:**
   ```bash
   chmod 644 /root/tftp-go/arm.efi
   ```

7. **Запуск TFTP-сервера:**
   ```bash
   ./tftp-go -server
   ```

   После запуска сервер начнет обслуживать запросы TFTP, предоставляя доступ к файлам, находящимся в директории `/root/tftp-go`.

---

## Часть 2: Настройка EFI Shell


Ниже приведена полная пошаговая инструкция по настройке сети и загрузке файла через TFTP в EFI Shell.

---

### 1. Переход в EFI Shell
Если вы ещё не в EFI Shell:
1. Загрузитесь в EFI Shell через меню загрузки BIOS/UEFI.
2. Дождитесь появления приглашения вида:
   ```
   Shell>
   ```

---

### 2. Переход к файловой системе
1. Введите команду для выбора доступного файлового устройства. Обычно это `fs0:`:
   ```shell
   fs0:
   ```
2. Проверьте содержимое устройства:
   ```shell
   dir
   ```
3. Перейдите в каталог `EFI`:
   ```shell
   cd EFI
   ```

---

### 3. Настройка сети
Для настройки сетевых интерфейсов выполните следующие шаги:

#### Настройка `eth0`:
1. Установите статический IP-адрес, маску подсети и шлюз:
   ```shell
   ifconfig -s eth0 static 10.0.40.147 255.255.255.0 10.0.0.1
   ```
2. Проверьте текущие настройки:
   ```shell
   ifconfig -l eth0
   ```

#### Настройка `eth1` (если требуется):
1. Установите статический IP-адрес, маску подсети и шлюз:
   ```shell
   ifconfig -s eth1 static 172.16.0.10 255.255.255.0 172.16.0.1
   ```
2. Проверьте текущие настройки:
   ```shell
   ifconfig -l eth1
   ```

#### Настройка DNS (если требуется):
Для добавления DNS-серверов используйте команду:
```shell
ifconfig -s eth0 dns 8.8.8.8 8.8.4.4
```

---

### 4. Проверка соединения
1. Убедитесь, что сеть работает, пингуя TFTP-сервер:
   ```shell
   ping 111.222.33.111
   ```

---

### 5. Загрузка файла через TFTP
1. Убедитесь, что на TFTP-сервере находится файл, который вы хотите загрузить (например, `arm.efi`).
2. Используйте следующую команду для загрузки файла:
   ```shell
   tftp 111.222.33.111 arm.efi
   ```
3. При успешной загрузке вы увидите сообщение о завершении загрузки.

---

### Полный пример команд:
```shell
fs0:
cd EFI
ifconfig -s eth0 static 10.0.40.147 255.255.255.0 10.0.0.1
ifconfig -l eth0
ping 111.222.33.111
tftp 111.222.33.111 arm.efi
```

---

### Возможные проблемы и их решения

1. **"File not found" или "Not Found":**
   - Убедитесь, что файл существует в папке `/root/tftp-go` на сервере.
   - Проверьте имя файла, включая регистр букв.

2. **"Transfer timed out":**
   - Убедитесь, что TFTP-сервер работает.
   - Проверьте сетевые настройки клиента и сервера.

3. **Проблемы с сетью:**
   - Проверьте настройки IP, маски подсети и шлюза.
   - Убедитесь, что пинг до сервера проходит успешно.

Теперь вы готовы настроить сервер TFTP и загрузить файлы через EFI Shell!
