–û—Ç–ª–∏—á–Ω–æ üöÄ! –¢–æ–≥–¥–∞ —è —Å–æ–±–µ—Ä—É **–ø–æ–ª–Ω—É—é –ø–æ—à–∞–≥–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é**, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º —É —Ç–µ–±—è –±—ã–ª–æ –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ: –æ—Ç Oracle Cloud –¥–æ LXC –∏ Docker.

---

# –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ IPv6 (Oracle Cloud ‚Üí Proxmox (PVE) ‚Üí LXC ‚Üí Docker)

## 1. Oracle Cloud (VNIC –∏ –ø–æ–¥—Å–µ—Ç–∏)

1. –í–∫–ª—é—á–∏—Ç—å IPv6 –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VCN –∏ Subnet (–≤ Oracle Console).

   * –£–∫–∞–∑–∞—Ç—å **IPv6 CIDR block** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2603:c027:d:f500::/56`).
   * –î–ª—è VNIC —Ö–æ—Å—Ç–∞ (PVE) –≤–∫–ª—é—á–∏—Ç—å **IPv6 auto-configuration**.
2. –í Security List –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞:

   * **Egress**: —Ä–∞–∑—Ä–µ—à–∏—Ç—å `::/0` ‚Üí `All Protocols`.
   * **Ingress**: —Ä–∞–∑—Ä–µ—à–∏—Ç—å `::/0` ‚Üí –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 22/tcp, 80/tcp, 443/tcp).

---

## 2. Proxmox (PVE host)

### 2.1 –°–µ—Ç—å

–í `/etc/network/interfaces` (–∏–ª–∏ —á–µ—Ä–µ–∑ GUI) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –º–æ—Å—Ç **vmbr0**:

```bash
auto vmbr0
iface vmbr0 inet static
    address 10.14.0.1/24

iface vmbr0 inet6 static
    address 2603:c027:d:f500::1/64
```

–§–∏–∑–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `enp2s0` –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π IPv6 (–æ—Ç Oracle) –∏ —Å–ª—É–∂–∏—Ç WAN.

### 2.2 sysctl

–í `/etc/sysctl.conf`:

```bash
net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1

# RA –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–Ω–µ—à–Ω–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
net.ipv6.conf.enp2s0.accept_ra=2
net.ipv6.conf.vmbr0.accept_ra=0

# Proxy NDP
net.ipv6.conf.enp2s0.proxy_ndp=1
net.ipv6.conf.vmbr0.proxy_ndp=1
```

–ü—Ä–∏–º–µ–Ω–∏—Ç—å:

```bash
sysctl -p
```

### 2.3 ndppd (–¥–ª—è Proxy NDP, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—Ä—è–º–æ–π IPv6 –≤ LXC)

`/etc/ndppd.conf`:

```conf
proxy enp2s0 {
    rule 2603:c027:d:f500::/64 {
        auto
    }
}
```

–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
systemctl enable ndppd --now
```

### 2.4 NAT66 (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

–ß—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤—Å–µ–≥–¥–∞ —Ö–æ–¥–∏–ª–∏ –Ω–∞—Ä—É–∂—É (–±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏–º —Ä–µ–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤):

```bash
ip6tables -t nat -A POSTROUTING -s 2603:c027:d:f500::/64 -o enp2s0 -j MASQUERADE
```

–°–æ—Ö—Ä–∞–Ω—è–µ–º:

```bash
ip6tables-save > /etc/ip6tables.rules
```

(–ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `netfilter-persistent`).

---

## 3. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä LXC (–Ω–∞–ø—Ä–∏–º–µ—Ä, `amnezia-tg`)

–í –∫–æ–Ω—Ñ–∏–≥–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`/etc/pve/lxc/103.conf`):

```conf
net0: name=eth0,bridge=vmbr0,firewall=1,gw=10.14.0.1,hwaddr=BC:24:11:3B:49:6E,\
ip=10.14.0.4/24,ip6=2603:c027:d:f500::101/64,gw6=2603:c027:d:f500::1,type=veth
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
ifconfig eth0
```

–í–∏–¥–∏–º IPv4 (`10.14.0.4`) –∏ IPv6 (`2603:c027:d:f500::101`).

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
ping -6 google.com
```

---

## 4. Docker –≤–Ω—É—Ç—Ä–∏ LXC

–ï—Å—Ç—å 2 —Å–ø–æ—Å–æ–±–∞ –ø—Ä–æ–∫–∏–Ω—É—Ç—å IPv6 –¥–∞–ª—å—à–µ.

### 4.1 NAT66 –∏ –¥–ª—è Docker

–ï—Å–ª–∏ LXC —Å–∏–¥–∏—Ç –∑–∞ NAT66, —Ç–æ Docker –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
–í `daemon.json` (–æ–±—ã—á–Ω–æ `/etc/docker/daemon.json`) –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```json
{
  "ipv6": true,
  "fixed-cidr-v6": "fd00:dead:beef::/48"
}
```

–≠—Ç–æ –¥–∞—Å—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º **ULA IPv6**, –∞ –∏—Å—Ö–æ–¥—è—â–∏–µ –ø–æ–π–¥—É—Ç –Ω–∞—Ä—É–∂—É —á–µ—Ä–µ–∑ NAT66.

### 4.2 –ü—Ä—è–º–æ–π IPv6 –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã **Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–º–µ–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ IPv6**:

1. –í LXC —Å–¥–µ–ª–∞—Ç—å macvlan-—Å–µ—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ `vmbr0`.
2. –í `docker-compose.yml` –∏–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —É–∫–∞–∑–∞—Ç—å:

```yaml
networks:
  default:
    driver: macvlan
    driver_opts:
      parent: eth0
    ipam:
      config:
        - subnet: "2603:c027:d:f500::/64"
          gateway: "2603:c027:d:f500::1"
```

3. –ù–∞–∑–Ω–∞—á–∏—Ç—å IPv6 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –≤—Ä—É—á–Ω—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä `2603:c027:d:f500::201`.

---

## 5. –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å —É —Ç–µ–±—è

* Oracle Cloud —Ä–∞–∑–¥–∞—ë—Ç –ø—É–±–ª–∏—á–Ω—ã–π `/56` IPv6.
* PVE –ø–æ–ª—É—á–∏–ª IPv6 –Ω–∞ `enp2s0` –∏ –Ω–∞ `vmbr0`.
* –í–∫–ª—é—á–∏–ª–∏ IPv6 —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ + Proxy NDP.
* –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –≤–∫–ª—é—á–∏–ª–∏ NAT66, –∏ —Ç–µ–ø–µ—Ä—å **LXC —Ö–æ–¥–∏—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ IPv6 —á–µ—Ä–µ–∑ –∞–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞**.
* –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ LXC IPv6 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## 6. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ø—Ä–æ–∫–∏–Ω—É—Ç—å IPv6 –≤ Docker

* –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥—è—â–∏–µ ‚Üí –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ NAT66 (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç).
* –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π IPv6 –ø—Ä—è–º–æ –≤ Docker ‚Üí –¥–µ–ª–∞–µ–º **macvlan** –∏ –≤—ã–¥–µ–ª—è–µ–º –∞–¥—Ä–µ—Å –∏–∑ –ø–æ–¥—Å–µ—Ç–∏ (`2603:c027:d:f500::/64`).

---

üëâ –•–æ—á–µ—à—å, —è —Å–æ–±–µ—Ä—É —Ç–µ–±–µ –≥–æ—Ç–æ–≤—ã–π **–ø—Ä–∏–º–µ—Ä `docker-compose.yml`** —Å IPv6 (–æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: NAT66 –∏ –ø—Ä—è–º–æ–π –ø—É–±–ª–∏—á–Ω—ã–π IPv6)?
