–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ! –ù–∏–∂–µ ‚Äî **–ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ DHCP –≤ Proxmox VE —á–µ—Ä–µ–∑ SDN**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–≤–æ–∏–º —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º –∏ —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ `dnsmasq`. –í—Å—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–∂–∞—Ç–æ, –ø–æ –¥–µ–ª—É, –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ.

---

## ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: **–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DHCP —á–µ—Ä–µ–∑ SDN –≤ Proxmox VE**

---

### üß© –û–±—â–∞—è —Å—Ö–µ–º–∞

- **Zone ID**: `DHCP`
- **VNet Name**: `DHCP`
- **Subnet**: `10.200.200.0/24`, —à–ª—é–∑ `10.200.200.1`
- **DHCP-—Å–µ—Ä–≤–µ—Ä**: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `dnsmasq` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Proxmox SDN)

---

### 1. üß± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `dnsmasq` –Ω–∞ –Ω–æ–¥–µ

```bash
apt update
apt install dnsmasq
```

---

### 2. ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SDN –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox

#### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–æ–Ω—ã

- –ü—É—Ç—å: **Datacenter ‚Üí SDN ‚Üí Zones ‚Üí Create**
- –¢–∏–ø: `Simple`
- ID: `DHCP`
- IPAM: `pve` (–∏–ª–∏ `none`)
- –ì–∞–ª–∫–∞ **automatic DHCP** ‚Äî –≤–∫–ª—é—á–µ–Ω–∞ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–æ–Ω–∞ `DHCP` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ DHCP —á–µ—Ä–µ–∑ `dnsmasq`.
<img width="296" alt="image" src="https://github.com/user-attachments/assets/f17d8a49-eb13-457c-b9c4-0b56a73b2371" />

---

#### 2.2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (VNet)

- –ü—É—Ç—å: **SDN ‚Üí Vnets ‚Üí Create**
- Name: `DHCP`
- Alias: `DHCP`
- Zone: `DHCP`
- –ì–∞–ª–∫–∏: `Isolate Ports` –∏ `VLAN Aware` ‚Äî **–≤—ã–∫–ª—é—á–µ–Ω—ã**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è L2-—Å–µ—Ç—å `DHCP` –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–∏–º—ë–Ω–Ω–æ–π –∑–æ–Ω—ã.

---

#### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Å–µ—Ç–∏ (Subnet)

- –ü—É—Ç—å: **SDN ‚Üí Subnets ‚Üí Create**
- Subnet: `10.200.200.0/24`
- Gateway: `10.200.200.1`
- SNAT: –≤–∫–ª—é—á–µ–Ω–æ ‚úÖ
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ VNet: `DHCP`
- –ü–µ—Ä–µ–π–¥–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É **DHCP Ranges** –∏ –∑–∞–¥–∞–π –¥–∏–∞–ø–∞–∑–æ–Ω:
  ```
  10.200.200.100 - 10.200.200.200
  ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `dnsmasq` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–∞–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.

---

### 3. üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞–∂–º–∏:
```text
Datacenter ‚Üí SDN ‚Üí Apply
```

–≠—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç SDN –∏ –ø–æ–¥–Ω–∏–º–µ—Ç `dnsmasq` –Ω–∞ –Ω—É–∂–Ω–æ–π –Ω–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

### 4. üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

#### 4.1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ `dnsmasq` –ø–æ–¥–Ω—è–ª—Å—è

```bash
ps aux | grep dnsmasq
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
/usr/sbin/dnsmasq --conf-file=/etc/pve/sdn/dnsmasq.conf ...
```

#### 4.2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 67 —Å–ª—É—à–∞–µ—Ç—Å—è

```bash
netstat -tulnp | grep :67
```

#### 4.3. –ü—Ä–æ–≤–µ—Ä—å –∂—É—Ä–Ω–∞–ª

```bash
journalctl -u dnsmasq
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ:
```
DHCP, IP range 10.200.200.100 -- 10.200.200.200
```

---

### 5. ‚ö° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –í–ú

1. –ü–æ–¥–∫–ª—é—á–∏ –í–ú –∫ VNet: `DHCP`
2. –í–Ω—É—Ç—Ä–∏ –í–ú –≤–∫–ª—é—á–∏ DHCP-–∫–ª–∏–µ–Ω—Ç:
   - **Linux**:
     ```bash
     dhclient -v
     ```
   - **Windows**:
     ```powershell
     ipconfig /renew
     ```

---

### üß© –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å DNS –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø—Ü–∏–∏:
- —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `/etc/pve/sdn/dnsmasq.conf` ‚Äî **–Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**, —Ç.–∫. SDN –º–æ–∂–µ—Ç –µ–≥–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å.
- –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≤–∫–ª–∞–¥–∫—É **DNS Server** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Zone/Subnet.
