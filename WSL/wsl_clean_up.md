—Å–¥–µ–ª–∞–µ–º ¬´–≥–µ–Ω–µ—Ä–∞–ª—å–Ω—É—é —É–±–æ—Ä–∫—É¬ª –≤ WSL2 (Ubuntu).
–†–∞–∑–æ–±—å—ë–º –Ω–∞ —à–∞–≥–∏, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω—É–∂–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ –Ω–µ —Å–Ω–µ—Å—Ç–∏.

---

## üîπ 1. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ apt/dpkg

–£–¥–∞–ª—è–µ—Ç –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ deb-—Ñ–∞–π–ª—ã, –ª–∏—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
sudo apt-get clean           # –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤ ( /var/cache/apt/archives )
sudo apt-get autoclean       # —É–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã
sudo apt-get autoremove -y   # —É–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

---

## üîπ 2. –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤

–í WSL systemd-–∂—É—Ä–Ω–∞–ª—ã –æ–±—ã—á–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã (–∏ –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≥–∏–≥–∞–±–∞–π—Ç—ã).

```bash
sudo journalctl --vacuum-time=1d
sudo journalctl --rotate
sudo journalctl --vacuum-size=100M
```

(–æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ä–∞–∑–º–µ—Ä –¥–æ 100M).

–ï—Å–ª–∏ systemd —É —Ç–µ–±—è –Ω–µ –Ω—É–∂–µ–Ω ‚Üí –º–æ–∂–Ω–æ –≤–æ–æ–±—â–µ:

```bash
sudo rm -rf /var/log/*
```

(–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

---

## üîπ 3. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```bash
sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*
```

---

## üîπ 4. –û—á–∏—Å—Ç–∫–∞ snap (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
sudo du -sh /var/lib/snapd/snaps   # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–º–µ—Ä
sudo snap set system refresh.retain=2
sudo snap remove $(snap list --all | awk '/disabled/{print $1, $2}' | xargs -n2 echo)
```

---

## üîπ 5. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```bash
rm -rf ~/.cache/*
```

---

## üîπ 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –º—É—Å–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
sudo du -sh /var/cache/*
sudo du -sh /var/log/*
du -sh ~/.cache/*
```

### –ß—Ç–æ–±—ã –¥–æ–≤–µ—Å—Ç–∏ –¥–æ ¬´–∏–¥–µ–∞–ª—å–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã¬ª –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –µ—â—ë:

#### 1. –ü–æ—á–∏—Å—Ç–∏—Ç—å apt-–∫—ç—à –¥–æ –Ω—É–ª—è

```bash
sudo rm -rf /var/cache/apt/archives/*
sudo rm -rf /var/cache/apt/*.bin
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ¬´–º—É—Å–æ—Ä–Ω—ã–µ¬ª —è–¥—Ä–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏

–¢—ã —É–∂–µ –≤–∏–¥–µ–ª, —á—Ç–æ `autoremove` —Å–Ω—ë—Å –ª–∏—à–Ω–∏–µ `linux-headers`. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–∂–∞—Ç—å:

```bash
dpkg -l | grep linux-headers
dpkg -l | grep linux-image
```

–∏ —Ä—É–∫–∞–º–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å—ë, —á—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ. –í WSL —è–¥—Ä–∞ –∏–∑ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ –≤–æ–æ–±—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (—è–¥—Ä–æ —É WSL —Å–≤–æ—ë). –¢–∞–∫ —á—Ç–æ **–≤—Å–µ –ø–∞–∫–µ—Ç—ã `linux-image-*` –∏ `linux-headers-*` –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–Ω–µ—Å—Ç–∏** ‚Äî –æ–Ω–∏ —Ç–æ–ª—å–∫–æ –º–µ—Å—Ç–æ –µ–¥—è—Ç.

```bash
sudo apt purge "linux-image-*" "linux-headers-*" -y
```

#### 3. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à–∏ systemd-resolved (–µ—Å–ª–∏ –Ω–∞–¥–æ)

```bash
sudo resolvectl flush-caches
```

---

### üöÄ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É —Ç–µ–±—è –≤–Ω—É—Ç—Ä–∏ Ubuntu –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ–µ.
–ê —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä VHDX –Ω–∞ –¥–∏—Å–∫–µ Windows ‚Äî –ø–æ—Å–ª–µ –≤—Å–µ—Ö —á–∏—Å—Ç–æ–∫ —Å–¥–µ–ª–∞–π:

## üîπ 7. –°–∂–∞—Ç–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –¥–∏—Å–∫–∞ (–µ—Å–ª–∏ –Ω–∞–¥–æ —É–º–µ–Ω—å—à–∏—Ç—å VHDX)

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –º–æ–∂–Ω–æ —Å–∂–∞—Ç—å —Å–∞–º —Ñ–∞–π–ª –¥–∏—Å–∫–∞ WSL:

1. –ó–∞–≤–µ—Ä—à–∞–µ–º WSL:

   ```powershell
   wsl --shutdown
   ```
2. –í PowerShell:

   ```powershell
   Optimize-VHD -Path "C:\Users\chelaxian\AppData\Local\Packages\<Canonical...>\LocalState\ext4.vhdx" -Mode Full
   ```

   (–Ω—É–∂–µ–Ω –º–æ–¥—É–ª—å Hyper-V, —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Windows Pro/Enterprise).

---

‚ö†Ô∏è –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ **–±–µ–∑–æ–ø–∞—Å–Ω—ã** –¥–ª—è —Å–∏—Å—Ç–µ–º—ã, –æ–Ω–∏ —á–∏—Å—Ç—è—Ç —Ç–æ–ª—å–∫–æ –∫—ç—à–∏/–ª–æ–≥–∏/–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

*(–Ω—É–∂–µ–Ω –º–æ–¥—É–ª—å Hyper-V, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Windows 11 Pro/Enterprise)*

---

–∫–æ–º–∞–Ω–¥–∞ `Optimize-VHD` –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω **Hyper-V** (Windows 11 Pro / Enterprise).
–ù–∞ **Windows 11 Home** –∏ –±–µ–∑ Hyper-V VMM –æ–Ω–∞ –¥–∞—ë—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–∫—É—é –æ—à–∏–±–∫—É: *"Virtual Machine Management service‚Ä¶ not found"*.

---

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:

#### üîπ 1. –í–∫–ª—é—á–∏—Ç—å Hyper-V (–µ—Å–ª–∏ —É —Ç–µ–±—è Pro/Enterprise)

```powershell
dism.exe /Online /Enable-Feature:Microsoft-Hyper-V /All
```

–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å `Optimize-VHD`.

---

#### üîπ 2. –ï—Å–ª–∏ Windows Home ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é WSL

–° –Ω–µ–¥–∞–≤–Ω–∏—Ö –≤–µ—Ä—Å–∏–π —É `wsl.exe` –ø–æ—è–≤–∏–ª—Å—è —Å–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–∏—Å—Ç–∫–∏ VHDX:

```powershell
wsl --shutdown
wsl --manage Ubuntu --compact
```

–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤:

```powershell
wsl --shutdown
wsl --system --compact
```

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–∞ Home, –∏ –Ω–∞ Pro.

---

#### üîπ 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ ‚Äî –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ DiskPart

–ï—Å–ª–∏ Hyper-V –Ω–µ—Ç –∏ `--compact` –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å VHDX —Ä—É–∫–∞–º–∏:

```powershell
diskpart
select vdisk file="C:\Users\chelaxian\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu24.04LTS_79rhkp1fndgsc\LocalState\ext4.vhdx"
attach vdisk readonly
compact vdisk
detach vdisk
exit
```

