### üìå –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –¥–ª—è **Keenetic Giga**: –∑–∞–ø—É—Å–∫ `ping_vpn_fgt.py` –ø–æ—Å–ª–µ —Ä–µ–±—É—Ç–∞

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `ping_vpn_fgt.py` –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ **Keenetic Giga**. –°–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—É–Ω–Ω–µ–ª—è–º–∏ **FortiGate**.

---

## üîπ **1. –†–∞–∑–º–µ—â–µ–Ω–∏–µ Python-—Å–∫—Ä–∏–ø—Ç–∞**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ping_vpn_fgt.py` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/tmp/mnt/EXT/home/`:

```sh
mkdir -p /tmp/mnt/EXT/home
nano /tmp/mnt/EXT/home/ping_vpn_fgt.py
```

–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ (`Ctrl + X`, –∑–∞—Ç–µ–º `Y`, `Enter`).

–î–∞–π—Ç–µ —Ñ–∞–π–ª—É –ø—Ä–∞–≤–æ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:

```sh
chmod +x /tmp/mnt/EXT/home/ping_vpn_fgt.py
```

---

## üîπ **2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ `/opt/etc/init.d/S99vpn_monitor`**
–°–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```sh
nano /opt/etc/init.d/S99vpn_monitor
```

–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```sh
#!/bin/sh

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
SCRIPT_PATH="/tmp/mnt/EXT/home/ping_vpn_fgt.py"
LOG_FILE="/tmp/mnt/EXT/home/ping_vpn_fgt.log"
PID_FILE="/var/run/vpn_monitor.pid"

start() {
    echo "–ó–∞–ø—É—Å–∫ VPN –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..." | tee -a $LOG_FILE
    python3 $SCRIPT_PATH >> $LOG_FILE 2>&1 &  # –ó–∞–ø—É—Å–∫–∞–µ–º –±–µ–∑ nohup
    echo $! > $PID_FILE  # –°–æ—Ö—Ä–∞–Ω—è–µ–º PID –ø—Ä–æ—Ü–µ—Å—Å–∞
}

stop() {
    echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ VPN –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..." | tee -a $LOG_FILE
    if [ -f "$PID_FILE" ]; then
        kill $(cat $PID_FILE) 2>/dev/null
        rm -f $PID_FILE
    fi
}

restart() {
    stop
    sleep 2
    start
}

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    *) echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {start|stop|restart}"; exit 1 ;;
esac

exit 0

```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (`Ctrl + X`, `Y`, `Enter`).

–î–∞–π—Ç–µ —Ñ–∞–π–ª—É –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:

```sh
chmod +x /opt/etc/init.d/S99vpn_monitor
```

---

## üîπ **3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –≤—Ä—É—á–Ω—É—é**
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Å—Ä–∞–∑—É:

```sh
/opt/etc/init.d/S99vpn_monitor start
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É:

```sh
ps | grep ping_vpn_fgt.py
```

---

## üîπ **4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫**
–ß—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, —Å–æ–∑–¥–∞–π—Ç–µ —Å—Å—ã–ª–∫—É:

```sh
ln -sf /opt/etc/init.d/S99vpn_monitor /opt/etc/rc.d/S99vpn_monitor
```

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞.

---

## üîπ **5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–µ–±—É—Ç–∞**
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä:

```sh
reboot
```

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```sh
cat /tmp/mnt/EXT/home/ping_vpn_fgt.log
```

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ø–µ—à–Ω–∞!

üöÄ **–¢–µ–ø–µ—Ä—å `ping_vpn_fgt.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏!**
